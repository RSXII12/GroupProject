<!DOCTYPE html>
<html lang="en">
    <!--TODO: vanish sign up/login when user logs in (javascript,html), create working seach function(javascript,ajax), make button to apply filters work (javascript), 
    align logo properly (javascript,css), create button to use search function(html,css) fix scroll bar (currently in wrong container and wrong direction)(html, css)-->
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>iBay Home</title>
        <link rel="stylesheet" href="buyerPage.css">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> 
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
        <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <script>
            $(function() {
                $("#price-slider").slider({
                    range: true,
                    min: 0,
                    max: 500,
                    values: [50, 300],
                    slide: function(event, ui) {
                        $("#price-range").val("$" + ui.values[0] + " - $" + ui.values[1]);
                        $("#price-range-label").text("$" + ui.values[0] + " - $" + ui.values[1]);
                    }
                });
    
                $("#price-range").val("$" + $("#price-slider").slider("values", 0) +
                    " - $" + $("#price-slider").slider("values", 1));
                $("#price-range-label").text("$" + $("#price-slider").slider("values", 0) +
                    " - $" + $("#price-slider").slider("values", 1));
            });
    
            function performSearch() {
                console.log("Search button clicked!");

                const searchText = $('#search-field').val();
                const [minPrice, maxPrice] = $("#price-slider").slider("values");
                const timeRemaining = $('#time-remaining').val();
                const location = $('#location').val();

                // Create an object for our parameters
                const params = {};
                
                // Only add parameters that are actually set by the user
                if (searchText) params.searchText = searchText;
                
                // Only apply price filter if it's not at default values
                const defaultMinPrice = 0;
                const defaultMaxPrice = 500;
                if (minPrice !== defaultMinPrice || maxPrice !== defaultMaxPrice) {
                    params.minPrice = minPrice;
                    params.maxPrice = maxPrice;
                }
                
                if (timeRemaining) params.timeRemaining = timeRemaining;
                if (location) params.location = location;

                $.ajax({
                    url: 'search.php',
                    type: 'GET',
                    dataType: 'json',
                    data: params,
                    success: function(items) {
                        console.log("Results:", items);
                        displayResults(items);
                    },
                    error: function(xhr, status, error) {
                        console.error("AJAX Error:", error);
                        console.log(xhr.responseText);
                    }
                });
}

function displayResults(items) {
    const container = document.querySelector(".main-content");
    let html = "<div><h3>Search Results:</h3>";

    if (!items.length) {
        html += "<p>No matching items found.</p>";
    } else {
        items.forEach(item => {
            html += `
                <div style="border:1px solid #ccc; padding:10px; margin:10px;">
                    <h4>${item.title}</h4>
                    <img src="${item.image}" style="width:150px; height:auto;"><br>
                    <p>${item.description}</p>
                    <p><strong>Price:</strong> $${item.price} (+ $${item.postage} postage)</p>
                    <p><strong>Time remaining:</strong> ${item.time_remaining} hours</p>
                </div>
            `;
        });
    }

    html += "</div>";
    container.innerHTML = html;
}

document.addEventListener("DOMContentLoaded", function() {
    // Wire both buttons to performSearch
    document.getElementById("search-button").addEventListener("click", performSearch);
    document.getElementById("apply-filters").addEventListener("click", performSearch);
});

        </script>
    </head>
    <body>
        <div class="header">
            <span>Please <a href="sellerLogin.html">Log in</a> or <a href="sellerSignUp.html">Sign up</a> to use iBay</span>
            <a href="sellerPage.html" class="create-listing">Create a listing</a>
        </div>
    
        <div class="container">
            <div class="sidebar">
                <div class="logo" style="text-align: center; margin-bottom: 20px;">
                    <a href="index.html"><img src="iBay-logo.png" style="max-width: 150px; height: auto;"></a>
                </div>
                
                <div class="search-options">
                    <h3>Advanced Search</h3>
                    <label for="price-range">Price Range:</label>
                    <input type="text" id="price-range" readonly style="border:0;">
                    <div id="price-slider"></div>
                    <label for="time-remaining">Time Remaining (hours)</label>
                    <input type="number" id="time-remaining" min="1" placeholder="Enter hours">
                    <label for="location">Location</label>
                    <input type="text" id="location" placeholder="Enter location">
                    <button id="apply-filters">Apply Filters</button>
                </div>
            </div>
    
            <div class="main-content">
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="search-field" class="search-bar" placeholder="Search field">
                    <button id="search-button" onclick="performSearch()">Search</button>
                </div>
                
            </div>
        </div>
    
        <div class="footer">
            Copyright @2025-25 iBay Inc. All rights reserved
        </div>
    </body>
</html>
